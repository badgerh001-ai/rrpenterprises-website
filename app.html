<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titan ERP | DIAGNOSTIC MODE</title>
    
    <link rel="stylesheet" href="style.css">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body { background-color: #020617; color: #fff; font-family: sans-serif; text-align: center; padding: 20px; }
        .box { max-width: 500px; margin: 30px auto; background: #0f172a; padding: 30px; border-radius: 15px; border: 1px solid #333; }
        .form-input { width: 100%; padding: 12px; margin-bottom: 15px; background: #1e293b; border: 1px solid #333; color: white; border-radius: 5px; box-sizing: border-box; }
        button { padding: 15px 30px; font-size: 16px; font-weight: bold; border-radius: 8px; cursor: pointer; border:none; width: 100%; margin-bottom: 10px; }
        .btn-green { background: #22c55e; color: #000; }
        
        #error-box { 
            background: #450a0a; color: #fca5a5; 
            padding: 15px; margin-top: 20px; 
            border: 1px solid #ef4444; display: none; text-align: left;
        }
        #success-box {
            background: #064e3b; color: #6ee7b7;
            padding: 15px; margin-top: 20px;
            border: 1px solid #10b981; display: none;
        }
    </style>
</head>

<body>

    <div class="box">
        <h2>CLOUD CONNECTION TEST</h2>
        <p style="color: #94a3b8; margin-bottom: 20px;">We are testing the "Write" permission to Google Cloud.</p>
        
        <input type="text" id="test-mobile" class="form-input" placeholder="Enter Mobile (e.g., 9999999999)">
        <button class="btn-green" onclick="testCloudWrite()">TEST REGISTRATION</button>
        
        <div id="success-box">
            ✅ <strong>SUCCESS!</strong><br>
            The Cloud ACCEPTED your data.<br>
            The system is working perfectly.
        </div>

        <div id="error-box">
            ❌ <strong>FAILED</strong><br>
            <span id="error-msg">Waiting...</span>
        </div>
    </div>

    <script>
        // === YOUR EXACT KEYS ===
        const firebaseConfig = {
            apiKey: "AIzaSyBUKdAvTmwcafSq0JJmFdCGCATcgukKZ_k",
            authDomain: "titan-erp-logistics.firebaseapp.com",
            projectId: "titan-erp-logistics",
            storageBucket: "titan-erp-logistics.firebasestorage.app",
            messagingSenderId: "114849355675",
            appId: "1:114849355675:web:e309f335ae2fc0af39f33e",
            measurementId: "G-T59Y55TCLM"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 1. DISABLE OFFLINE MODE (Forces Truth)
        try {
            db.settings({ persistence: false }); 
        } catch(e) { console.log("Persistence setting skipped"); }

        function testCloudWrite() {
            const mobile = document.getElementById('test-mobile').value.trim();
            const errBox = document.getElementById('error-box');
            const succBox = document.getElementById('success-box');
            const errMsg = document.getElementById('error-msg');
            
            if(!mobile) { alert("Please enter a mobile number"); return; }

            errBox.style.display = 'none';
            succBox.style.display = 'none';

            // 2. ATTEMPT REAL CLOUD WRITE
            db.collection('users').add({
                mobile: mobile,
                test_date: new Date().toString(),
                type: "Diagnostic Check"
            })
            .then(() => {
                succBox.style.display = 'block';
                alert("SUCCESS! Data reached Google Cloud.");
            })
            .catch((error) => {
                errBox.style.display = 'block';
                errMsg.innerText = "Error Code: " + error.code + "\nMessage: " + error.message;
                console.error("Write Error:", error);
            });
        }
    </script>
</body>
</html>
